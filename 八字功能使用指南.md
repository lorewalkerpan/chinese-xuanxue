# 生辰八字功能使用指南

## 功能概述

本次更新为系统新增了**生辰八字计算功能**，可以根据公历日期时间自动计算四柱八字（年柱、月柱、日柱、时柱）及五行属性。

## 新增文件清单

### 核心代码文件

#### 枚举类
1. `src/main/java/com/sixyao/divination/enums/TianGan.java`
   - 天干枚举（甲乙丙丁戊己庚辛壬癸）
   - 包含五行属性和阴阳属性

2. `src/main/java/com/sixyao/divination/enums/DiZhi.java`
   - 地支枚举（子丑寅卯辰巳午未申酉戌亥）
   - 包含五行属性、阴阳属性、生肖、时辰范围

#### 模型类
3. `src/main/java/com/sixyao/divination/model/Pillar.java`
   - 柱模型（年柱、月柱、日柱、时柱）
   - 包含天干和地支的组合

4. `src/main/java/com/sixyao/divination/model/BaZi.java`
   - 八字模型
   - 包含四柱完整信息

#### DTO类
5. `src/main/java/com/sixyao/divination/dto/BaZiRequest.java`
   - 八字计算请求对象

6. `src/main/java/com/sixyao/divination/dto/BaZiResponse.java`
   - 八字计算响应对象
   - 包含五行信息

#### 服务层
7. `src/main/java/com/sixyao/divination/service/BaZiService.java`
   - 八字计算核心服务
   - 实现年柱、月柱、日柱、时柱的计算算法

#### 控制层
8. `src/main/java/com/sixyao/divination/controller/BaZiController.java`
   - RESTful API接口
   - 提供3种计算方式（POST、GET、当前时间）

### 文档文件
9. `BAZI_API_TEST_EXAMPLES.md`
   - 详细的API测试示例文档
   - 包含curl和PowerShell命令示例

10. `test_bazi.http`
    - HTTP测试文件（可用于IntelliJ IDEA或VS Code的REST Client插件）

11. `八字功能使用指南.md`（本文件）
    - 功能使用说明

12. `README.md`（已更新）
    - 添加了八字功能的完整说明

## API接口说明

### 1. 健康检查
```
GET /api/bazi/health
```

### 2. 计算指定日期八字（POST）
```
POST /api/bazi/calculate
Content-Type: application/json

{
  "year": 1990,
  "month": 5,
  "day": 15,
  "hour": 14,
  "minute": 30,
  "second": 0
}
```

### 3. 计算指定日期八字（GET）
```
GET /api/bazi/calculate?year=1990&month=5&day=15&hour=14&minute=30&second=0
```

### 4. 计算当前时间八字
```
GET /api/bazi/now
```

## 快速测试

### 使用PowerShell测试

```powershell
# 1. 健康检查
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/bazi/health"

# 2. 计算指定日期八字
$body = @{
    year = 1990
    month = 5
    day = 15
    hour = 14
    minute = 30
    second = 0
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/bazi/calculate" `
  -Method Post `
  -ContentType "application/json" `
  -Body $body

# 3. 计算当前时间八字
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/bazi/now"
```

### 使用CMD测试

```cmd
REM 健康检查
curl http://localhost:8080/xuanxue/api/bazi/health

REM 计算指定日期八字
curl -X POST http://localhost:8080/xuanxue/api/bazi/calculate ^
  -H "Content-Type: application/json" ^
  -d "{\"year\":1990,\"month\":5,\"day\":15,\"hour\":14,\"minute\":30,\"second\":0}"

REM 计算当前时间八字
curl http://localhost:8080/xuanxue/api/bazi/now
```

## 响应示例

```json
{
  "code": 200,
  "message": "八字计算成功",
  "data": {
    "yearPillar": "庚午",
    "monthPillar": "辛巳",
    "dayPillar": "甲子",
    "hourPillar": "辛未",
    "baZiString": "庚午 辛巳 甲子 辛未",
    "solarDate": "1990年05月15日 14时30分00秒",
    "lunarDate": "农历 1990年",
    "wuXingInfo": {
      "yearGanWuXing": "金",
      "yearZhiWuXing": "火",
      "monthGanWuXing": "金",
      "monthZhiWuXing": "火",
      "dayGanWuXing": "木",
      "dayZhiWuXing": "水",
      "hourGanWuXing": "金",
      "hourZhiWuXing": "土"
    }
  }
}
```

## 参数说明

### 输入参数
- `year`：年份（必填，1900-2100）
- `month`：月份（必填，1-12）
- `day`：日期（必填，1-31）
- `hour`：小时（可选，默认0，0-23）
- `minute`：分钟（可选，默认0，0-59）
- `second`：秒（可选，默认0，0-59）

### 输出字段说明
- `yearPillar`：年柱（天干地支组合）
- `monthPillar`：月柱（天干地支组合）
- `dayPillar`：日柱（天干地支组合）
- `hourPillar`：时柱（天干地支组合）
- `baZiString`：完整八字字符串（四柱组合）
- `solarDate`：公历日期时间（格式化显示）
- `lunarDate`：农历日期（简化版本）
- `wuXingInfo`：五行属性信息
  - 包含每柱天干和地支的五行属性

## 算法说明

### 年柱计算
- 以立春为界（简化处理：1-2月算上一年）
- 使用公式计算天干地支

### 月柱计算
- 根据年干和月份推算
- 使用五虎遁月口诀

### 日柱计算
- 使用基准日期（1900年1月31日）
- 计算天数差值推算

### 时柱计算
- 根据日干和时辰推算
- 使用五鼠遁日口诀

## 技术特点

1. ✅ 符合编码规范
   - 类和方法包含完整注释
   - 注释包含创建人（wbguan2）
   - 方法注释包含基本出入参说明
   - 无行尾注释

2. ✅ 代码质量
   - 每个类文件不超过300行
   - 每个方法入参不超过7个
   - 每个方法不超过120行
   - 遵循单一职责原则

3. ✅ Java 8兼容
   - 使用Java 8语法特性
   - 使用LocalDateTime进行日期处理

4. ✅ Spring Boot集成
   - 使用@Service和@RestController注解
   - 统一的ApiResponse响应格式
   - 完善的异常处理

## 运行项目

```cmd
# 编译项目
mvn clean package

# 运行项目
mvn spring-boot:run

# 或直接运行jar
java -jar target/chinese-xuanxue-1.0.0.jar
```

## 注意事项

1. **节气处理**：当前版本月柱计算使用简化算法（1-2月算上一年），完整版本应考虑24节气精确时间。

2. **农历转换**：当前版本农历日期为简化显示，如需完整农历信息，需集成农历转换库。

3. **时辰划分**：严格按照23:00-1:00为子时的传统划分方法。

4. **计算范围**：支持1900-2100年的日期计算。

5. **文化学习**：本功能仅用于学习和研究中国传统文化，结果仅供参考。

## 后续优化方向

1. 集成完整的农历转换算法
2. 添加节气精确计算（用于月柱准确定位）
3. 增加五行旺衰分析
4. 添加十神分析
5. 实现大运流年推算
6. 提供更详细的八字解读

## 相关文档

- [详细API测试文档](BAZI_API_TEST_EXAMPLES.md)
- [项目完整说明](README.md)
- [六爻占卜API文档](API_TEST_EXAMPLES.md)

---

**创建人：** wbguan2  
**创建日期：** 2025-11-27  
**版本：** 1.0.0

