# 六爻功能使用指南

## 功能概述

六爻占卜是中国传统占卜方法之一，通过起卦、解卦来预测事物的发展趋势。本系统实现了**六爻占卜的核心功能**，包括随机起卦、指定种子起卦、手动解析卦象等功能，并提供了美观的卦象图可视化展示。

## 核心特性

✅ **随机起卦**：模拟三枚铜钱法，随机生成六爻卦象  
✅ **指定种子起卦**：使用固定种子生成可重现的卦象  
✅ **手动解析**：支持输入特定爻值进行卦象解析  
✅ **卦象图展示**：自动生成美观的ASCII卦象图  
✅ **本卦与变卦**：自动计算变卦及动爻位置  
✅ **卦辞象辞**：提供完整的卦辞和象辞解读

---

## API接口说明

### 1. 健康检查

**接口地址：** `GET /api/divination/health`

**描述：** 检查六爻占卜服务运行状态。

**响应示例：**
```json
{
  "code": 200,
  "message": "中国玄学-六爻占卜服务运行正常",
  "data": null
}
```

---

### 2. 生成卦象（随机）

**接口地址：** `GET /api/divination/generate`

**描述：** 使用当前时间戳作为随机种子，模拟三枚铜钱法随机生成六爻卦象。

**使用场景：** 日常占卜，每次调用生成不同的卦象。

**响应示例：**
```json
{
  "code": 200,
  "message": "卦象生成成功",
  "data": {
    "timestamp": "2025-11-27T10:30:00.000+00:00",
    "originalHexagram": {
      "name": "火雷噬嗑",
      "upperTrigram": "离",
      "lowerTrigram": "震",
      "hexagramText": "噬嗑：亨。利用狱。",
      "imageText": "雷电噬嗑，先王以明罚敕法。",
      "yaos": [
        {"position": 1, "type": "老阴", "value": 6, "isChanging": true},
        {"position": 2, "type": "少阴", "value": 8, "isChanging": false},
        {"position": 3, "type": "少阳", "value": 7, "isChanging": false},
        {"position": 4, "type": "少阳", "value": 7, "isChanging": false},
        {"position": 5, "type": "少阴", "value": 8, "isChanging": false},
        {"position": 6, "type": "老阳", "value": 9, "isChanging": true}
      ]
    },
    "changedHexagram": {
      "name": "山火贲",
      "upperTrigram": "艮",
      "lowerTrigram": "离",
      "hexagramText": "贲：亨。小利有攸往。",
      "imageText": "山下有火，贲；君子以明庶政，无敢折狱。"
    },
    "changingPositions": [1, 6],
    "interpretation": "本卦为火雷噬嗑，变卦为山火贲。动爻位置：初爻、上爻。",
    "originalHexagramDiagram": "┌─────────────────────────┐\n│   火雷噬嗑   │\n├─────────────────────────┤\n│ ━  ━  第6爻：老阳 ★动爻 │\n│ ━  ━  第5爻：少阴 │\n│ ━━━━━  第4爻：少阳 │\n├─ 上卦：☲ 离（火） ─┤\n│ ━━━━━  第3爻：少阳 │\n│ ━  ━  第2爻：少阴 │\n│ ━  ━  第1爻：老阴 ★动爻 │\n├─ 下卦：☳ 震（雷） ─┤\n└─────────────────────────┘",
    "changedHexagramDiagram": "┌─────────────────────────┐\n│   山火贲   │\n├─────────────────────────┤\n│ ━  ━  第6爻：少阴 │\n│ ━  ━  第5爻：少阴 │\n│ ━━━━━  第4爻：少阳 │\n├─ 上卦：☶ 艮（山） ─┤\n│ ━━━━━  第3爻：少阳 │\n│ ━  ━  第2爻：少阴 │\n│ ━━━━━  第1爻：少阳 │\n├─ 下卦：☲ 离（火） ─┤\n└─────────────────────────┘"
  }
}
```

---

### 3. 生成卦象（指定种子）

**接口地址：** `GET /api/divination/generate/{seed}`

**描述：** 使用指定的随机种子生成卦象，相同种子产生相同结果。

**使用场景：** 
- 重现历史卦象
- 测试和验证
- 分享特定卦象

**路径参数：**
- `seed`：随机种子（Long类型，如：123456789）

**示例：** `GET /api/divination/generate/123456789`

**响应格式：** 与随机生成接口相同

---

### 4. 解析卦象

**接口地址：** `POST /api/divination/parse`

**描述：** 根据提供的爻值解析卦象。适用于手动起卦或传统起卦方法。

**使用场景：**
- 使用铜钱、蓍草等传统方法起卦后输入结果
- 验证特定卦象的解读
- 教学演示

**请求体：**
```json
{
  "yaoValues": [7, 8, 9, 6, 7, 8]
}
```

**参数说明：**
- `yaoValues`：6个爻的数值数组（从下到上排列）
- 数值范围：6-9
  - **6 = 老阴**（阴爻，会变）━  ━ ★
  - **7 = 少阳**（阳爻，不变）━━━━━
  - **8 = 少阴**（阴爻，不变）━  ━
  - **9 = 老阳**（阳爻，会变）━━━━━ ★

**爻值顺序说明：**
```
第6爻（上爻） ← yaoValues[5]
第5爻        ← yaoValues[4]
第4爻        ← yaoValues[3]
─────────── 上下卦分界
第3爻        ← yaoValues[2]
第2爻        ← yaoValues[1]
第1爻（初爻） ← yaoValues[0]
```

**响应格式：** 与生成卦象接口相同

---

### 5. 获取卦象详情

**接口地址：** `GET /api/divination/details/{seed}`

**描述：** 根据种子获取卦象的详细信息和解析。

**路径参数：**
- `seed`：随机种子（Long类型）

**示例：** `GET /api/divination/details/987654321`

**响应格式：** 与生成卦象接口相同

---

## 快速测试

### 使用PowerShell测试

```powershell
# 1. 健康检查
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/divination/health"

# 2. 生成随机卦象
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/divination/generate"

# 3. 使用指定种子生成
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/divination/generate/123456789"

# 4. 解析卦象
$body = @{
    yaoValues = @(7, 8, 9, 6, 7, 8)
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/divination/parse" `
  -Method Post `
  -ContentType "application/json" `
  -Body $body

# 5. 获取卦象详情
Invoke-RestMethod -Uri "http://localhost:8080/xuanxue/api/divination/details/987654321"
```

---

### 使用CMD测试

```cmd
REM 健康检查
curl http://localhost:8080/xuanxue/api/divination/health

REM 生成随机卦象
curl http://localhost:8080/xuanxue/api/divination/generate

REM 使用指定种子生成
curl http://localhost:8080/xuanxue/api/divination/generate/123456789

REM 解析卦象
curl -X POST http://localhost:8080/xuanxue/api/divination/parse ^
  -H "Content-Type: application/json" ^
  -d "{\"yaoValues\":[7,8,9,6,7,8]}"

REM 获取卦象详情
curl http://localhost:8080/xuanxue/api/divination/details/987654321
```

---

## 六爻基础知识

### 1. 什么是六爻？

六爻是由六个爻（阴爻或阳爻）组成的卦象，共有64种组合，即六十四卦。每个卦象由两个三爻卦（八卦）组成：
- **上卦（外卦）**：第4、5、6爻
- **下卦（内卦）**：第1、2、3爻

### 2. 八卦符号对照表

| 八卦 | 符号 | 自然象征 | 卦象组成 | 五行 |
|------|------|---------|---------|------|
| 乾 | ☰ | 天 | 三阳爻 | 金 |
| 兑 | ☱ | 泽 | 上阴下阳阳 | 金 |
| 离 | ☲ | 火 | 上阳下阴阳 | 火 |
| 震 | ☳ | 雷 | 上阴阴下阳 | 木 |
| 巽 | ☴ | 风 | 上阳阳下阴 | 木 |
| 坎 | ☵ | 水 | 上阴下阳阴 | 水 |
| 艮 | ☶ | 山 | 上阳下阴阴 | 土 |
| 坤 | ☷ | 地 | 三阴爻 | 土 |

### 3. 爻的类型详解

| 数值 | 名称 | 符号 | 阴阳 | 是否变爻 | 变化方向 | 说明 |
|------|------|------|------|---------|---------|------|
| 9 | 老阳 | ━━━━━ ★ | 阳 | ✅ 是 | 变为阴爻 | 阳极则阴生 |
| 7 | 少阳 | ━━━━━ | 阳 | ❌ 否 | 不变 | 阳气稳定 |
| 6 | 老阴 | ━  ━ ★ | 阴 | ✅ 是 | 变为阳爻 | 阴极则阳生 |
| 8 | 少阴 | ━  ━ | 阴 | ❌ 否 | 不变 | 阴气稳定 |

### 4. 三枚铜钱法

传统起卦使用三枚铜钱，抛掷六次得到六爻：

**计算规则：**
- 铜钱正面（字面）= 2
- 铜钱反面（面）= 3

**单次抛掷结果：**
- 三个正面：2+2+2 = 6（老阴）★
- 两正一反：2+2+3 = 7（少阳）
- 两反一正：3+3+2 = 8（少阴）
- 三个反面：3+3+3 = 9（老阳）★

**起卦步骤：**
1. 抛掷第一次 → 得第1爻（初爻）
2. 抛掷第二次 → 得第2爻
3. 抛掷第三次 → 得第3爻
4. 抛掷第四次 → 得第4爻
5. 抛掷第五次 → 得第5爻
6. 抛掷第六次 → 得第6爻（上爻）

### 5. 本卦与变卦

- **本卦**：初次得到的卦象，代表当前状态
- **变卦**：动爻（老阳、老阴）变化后的卦象，代表未来趋势
- **动爻**：标记★的爻，会发生阴阳转换

**判断规则：**
- 有动爻 → 有变卦 → 事情会发展变化
- 无动爻 → 无变卦 → 事情相对稳定

---

## 卦象图说明

系统会自动生成美观的ASCII卦象图，详细说明请参考：[卦象图说明文档](HEXAGRAM_DIAGRAM_GUIDE.md)

### 卦象图示例

```
┌─────────────────────────┐
│   火雷噬嗑   │
├─────────────────────────┤
│ ━  ━  第6爻：老阳 ★动爻 │  ← 会变
│ ━  ━  第5爻：少阴 │
│ ━━━━━  第4爻：少阳 │
├─ 上卦：☲ 离（火） ─┤
│ ━━━━━  第3爻：少阳 │
│ ━  ━  第2爻：少阴 │
│ ━  ━  第1爻：老阴 ★动爻 │  ← 会变
├─ 下卦：☳ 震（雷） ─┤
└─────────────────────────┘
```

**阅读要点：**
- 📖 从下往上读（第1爻在最下面）
- ⭐ 关注★动爻标记
- 🔄 对比本卦和变卦的差异
- 📚 结合卦辞和象辞解读

---

## 实战案例

### 案例1：纯阳卦（乾为天）

**起卦结果：** `[9, 9, 9, 9, 9, 9]`

**解读：**
- 六爻全阳，为乾卦
- 全部为老阳，六爻皆动
- 本卦：乾为天（☰☰）
- 变卦：坤为地（☷☷）
- **卦象含义：** 阳极转阴，物极必反，盛极而衰

---

### 案例2：有变爻的卦

**起卦结果：** `[7, 8, 6, 7, 8, 9]`

**解读：**
```
本卦分析：
- 下卦：震（雷）= 阳阴阴 = [7,8,6] → ☳
- 上卦：艮（山）= 阳阴阴 = [7,8,9] → ☶
- 本卦：山雷颐
- 动爻：第3爻（老阴6）、第6爻（老阳9）

变卦分析：
- 第3爻：老阴变少阳（6→7）
- 第6爻：老阳变少阴（9→8）
- 变卦：天风姤
```

---

### 案例3：静卦（无变爻）

**起卦结果：** `[7, 7, 7, 8, 8, 8]`

**解读：**
- 下卦：乾（天）= 阳阳阳 = [7,7,7] → ☰
- 上卦：坤（地）= 阴阴阴 = [8,8,8] → ☷
- 本卦：地天泰
- 动爻：无
- 变卦：无
- **卦象含义：** 无变化，以本卦断吉凶，局势稳定

---

## 技术特点

### 1. ✅ 符合编码规范

- 类和方法包含完整注释
- 注释包含创建人（wbguan2）
- 方法注释包含基本出入参说明
- 无行尾注释

### 2. ✅ 代码质量

- 每个类文件不超过300行
- 每个方法入参不超过7个
- 每个方法不超过120行
- 遵循单一职责原则

### 3. ✅ Java 8兼容

- 使用Java 8语法特性
- 使用Date进行时间戳记录
- 完整的Getter/Setter方法

### 4. ✅ Spring Boot集成

- 使用@Service和@RestController注解
- 统一的ApiResponse响应格式
- 完善的异常处理

---

## 运行项目

```cmd
# 编译项目
mvn clean package

# 运行项目
mvn spring-boot:run

# 或直接运行jar
java -jar target/chinese-xuanxue-1.0.0.jar
```

**默认访问地址：** http://localhost:8080/xuanxue

---

## 注意事项

### 1. 📌 起卦的诚心

传统六爻占卜强调"诚则灵"，虽然是数字化实现，但建议：
- 起卦前静心思考问题
- 一事一卦，不可重复占问同一件事
- 使用随机生成时，凭第一感觉选择结果

### 2. 📌 解卦原则

**断卦优先级：**
1. **六爻皆动**：以变卦的卦辞断
2. **一爻动**：以动爻的爻辞断
3. **两爻动**：以上爻的爻辞断
4. **三爻动**：以本卦和变卦的卦辞断，以本卦为主
5. **四爻动**：以下面不动的两爻断
6. **五爻动**：以不动爻的爻辞断
7. **六爻不动**：以本卦的卦辞断

### 3. 📌 时效性

- 六爻占卜有时效性，一般应验期为3-6个月
- 过时的卦象失去参考意义

### 4. 📌 文化学习

本功能仅用于学习和研究中国传统文化，结果仅供参考，不应作为决策的唯一依据。

---

## 后续优化方向

### 功能增强
1. 🔜 添加六亲装卦功能
2. 🔜 实现世应分析
3. 🔜 增加五行生克关系分析
4. 🔜 添加用神取用功能
5. 🔜 提供更详细的爻辞解读

### 起卦方式
6. 🔜 支持时间起卦法
7. 🔜 支持数字起卦法
8. 🔜 支持梅花易数起卦

### 用户体验
9. 🔜 增加卦象查询功能（按卦名搜索）
10. 🔜 提供卦象历史记录
11. 🔜 导出卦象图片功能

---

## 相关文档

- [卦象图详细说明](HEXAGRAM_DIAGRAM_GUIDE.md) 📊
- [项目完整说明](README.md) 📘
- [生辰八字功能文档](八字功能使用指南.md) 🆕

---

## 六十四卦速查表

### 乾宫八卦
| 序号 | 卦名 | 上卦 | 下卦 | 卦符 |
|------|------|------|------|------|
| 1 | 乾为天 | ☰乾 | ☰乾 | ☰☰ |
| 2 | 天风姤 | ☰乾 | ☴巽 | ☰☴ |
| 3 | 天山遁 | ☰乾 | ☶艮 | ☰☶ |
| 4 | 天地否 | ☰乾 | ☷坤 | ☰☷ |
| 5 | 风地观 | ☴巽 | ☷坤 | ☴☷ |
| 6 | 山地剥 | ☶艮 | ☷坤 | ☶☷ |
| 7 | 火地晋 | ☲离 | ☷坤 | ☲☷ |
| 8 | 火天大有 | ☲离 | ☰乾 | ☲☰ |

### 坤宫八卦
| 序号 | 卦名 | 上卦 | 下卦 | 卦符 |
|------|------|------|------|------|
| 9 | 坤为地 | ☷坤 | ☷坤 | ☷☷ |
| 10 | 地雷复 | ☷坤 | ☳震 | ☷☳ |
| 11 | 地泽临 | ☷坤 | ☱兑 | ☷☱ |
| 12 | 地天泰 | ☷坤 | ☰乾 | ☷☰ |
| 13 | 雷天大壮 | ☳震 | ☰乾 | ☳☰ |
| 14 | 泽天夬 | ☱兑 | ☰乾 | ☱☰ |
| 15 | 水天需 | ☵坎 | ☰乾 | ☵☰ |
| 16 | 水地比 | ☵坎 | ☷坤 | ☵☷ |

*（其他48卦请参考《周易》完整卦序）*

---

## 常见问题FAQ

### Q1：为什么相同种子生成的卦象一样？

**A**：这是设计特性。使用固定种子可以重现历史卦象，便于分享、验证和教学。如需随机卦象，请使用 `/generate` 接口（不带种子参数）。

### Q2：如何理解本卦和变卦的关系？

**A**：
- **本卦**：代表事物的现状
- **变卦**：代表事物的发展趋势
- **动爻**：是引起变化的关键因素

如果有变卦，要结合本卦和变卦一起分析，才能全面把握事态。

### Q3：没有动爻怎么办？

**A**：无动爻的卦称为"静卦"，表示事态相对稳定，主要依据本卦的卦辞和象辞来判断吉凶。

### Q4：爻值的顺序为什么是从下到上？

**A**：这是《周易》的传统规则。卦象模拟事物从基础到顶峰的发展过程，初爻（第1爻）代表事物的开始或基础，上爻（第6爻）代表事物的顶点或结果。

### Q5：API返回的解读（interpretation）准确吗？

**A**：当前版本提供的是基础的卦象信息组合。完整的六爻解读需要考虑六亲、世应、用神、五行生克等多重因素，建议结合传统六爻书籍深入学习。

---

**创建人：** wbguan2  
**创建日期：** 2025-11-27  
**版本：** 1.0.0  
**适用项目：** chinese-xuanxue（中国玄学系统）

